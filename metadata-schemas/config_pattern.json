{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Configuration Pattern Metadata Schema",
  "description": "Metadata schema for configuration pattern knowledge entries",
  "type": "object",
  "required": [
    "unique_id",
    "type",
    "component",
    "importance",
    "created_at"
  ],
  "properties": {
    "unique_id": {
      "type": "string",
      "pattern": "^config-[a-z0-9-]+$",
      "description": "Format: config-{description}",
      "examples": ["config-qdrant-connection", "config-postgres-pooling"]
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for deduplication"
    },
    "type": {
      "type": "string",
      "const": "config_pattern",
      "description": "Must be 'config_pattern'"
    },
    "component": {
      "type": "string",
      "enum": [
        "qdrant",
        "postgres",
        "neo4j",
        "redis",
        "agents",
        "docker",
        "api",
        "dashboard",
        "monitoring",
        "security"
      ],
      "description": "Component being configured"
    },
    "sub_component": {
      "type": "string",
      "description": "Specific subcomponent or service"
    },
    "config_category": {
      "type": "string",
      "enum": [
        "connection",
        "performance",
        "security",
        "logging",
        "monitoring",
        "storage",
        "networking",
        "resource_limits"
      ],
      "description": "Configuration category"
    },
    "epic_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Epic where configuration was defined"
    },
    "story_id": {
      "type": "string",
      "pattern": "^[0-9]+-[0-9]+$",
      "description": "Story where configuration was defined"
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Date when pattern was documented"
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "Date of most recent update"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this configuration pattern is deprecated"
    },
    "superseded_by": {
      "type": "string",
      "description": "unique_id of replacement configuration"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version of this configuration"
    },
    "replaces": {
      "type": "string",
      "description": "Previous version unique_id"
    },
    "breaking_change": {
      "type": "boolean",
      "description": "Does this configuration change break compatibility?"
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Importance of this configuration"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence in configuration best practice"
    },
    "source": {
      "type": "string",
      "enum": [
        "documentation",
        "testing",
        "performance_analysis",
        "vendor_recommendation",
        "incident_analysis"
      ],
      "description": "Source of this configuration pattern"
    },
    "environment": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["development", "testing", "staging", "production", "local", "vps", "all"]
      },
      "description": "Environments where this configuration applies"
    },
    "config_file": {
      "type": "string",
      "description": "Configuration file path",
      "examples": [".env", "docker-compose.yml", "config/qdrant.yaml"]
    },
    "required_values": {
      "type": "object",
      "description": "Required configuration values"
    },
    "optional_values": {
      "type": "object",
      "description": "Optional configuration values with defaults"
    },
    "validation_rules": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "How to validate configuration values"
    },
    "common_mistakes": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Common configuration errors to avoid"
    },
    "security_considerations": {
      "type": "string",
      "description": "Security implications of this configuration"
    },
    "performance_impact": {
      "type": "string",
      "description": "How this configuration affects performance"
    },
    "resource_requirements": {
      "type": "object",
      "properties": {
        "memory": {
          "type": "string"
        },
        "cpu": {
          "type": "string"
        },
        "disk": {
          "type": "string"
        },
        "network": {
          "type": "string"
        }
      },
      "description": "Resource requirements for this configuration"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Other configurations this depends on"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 3,
      "maxItems": 15,
      "description": "Key terms for search"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Related knowledge entries"
    },
    "search_intent": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Search queries that should find this"
    },
    "example_values": {
      "type": "object",
      "description": "Example configuration values"
    },
    "testing_approach": {
      "type": "string",
      "description": "How to test this configuration"
    },
    "rollback_procedure": {
      "type": "string",
      "description": "How to revert this configuration if needed"
    }
  },
  "additionalProperties": false
}
