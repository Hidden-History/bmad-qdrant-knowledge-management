{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Specification Metadata Schema",
  "description": "Metadata schema for agent specification knowledge entries",
  "type": "object",
  "required": [
    "unique_id",
    "type",
    "agent_id",
    "agent_name",
    "component",
    "importance",
    "created_at"
  ],
  "properties": {
    "unique_id": {
      "type": "string",
      "pattern": "^agent-[0-9]{2}[a-z]?-spec$",
      "description": "Format: agent-{id}-spec",
      "examples": ["agent-15-spec", "agent-08a-spec"]
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for deduplication"
    },
    "type": {
      "type": "string",
      "const": "agent_spec",
      "description": "Must be 'agent_spec'"
    },
    "agent_id": {
      "type": "string",
      "pattern": "^agent_[0-9]{2}[a-z]?$",
      "description": "Agent identifier",
      "examples": ["agent_15", "agent_08a", "agent_02"]
    },
    "agent_name": {
      "type": "string",
      "description": "Human-readable agent name",
      "examples": ["storage_router", "ocr_processor", "citation_extractor"]
    },
    "component": {
      "type": "string",
      "const": "agents",
      "description": "Must be 'agents'"
    },
    "sub_component": {
      "type": "string",
      "description": "Agent category or pipeline stage",
      "examples": ["storage", "processing", "extraction", "classification"]
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^agent_[0-9]{2}[a-z]?$"
      },
      "description": "List of agent IDs this agent depends on",
      "examples": [["agent_03", "agent_08"]]
    },
    "dependents": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^agent_[0-9]{2}[a-z]?$"
      },
      "description": "List of agents that depend on this one"
    },
    "integration_points": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "External systems this agent interacts with",
      "examples": [["qdrant_tiers", "postgres_routing_log", "neo4j_citations"]]
    },
    "epic_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Epic where agent was implemented"
    },
    "story_id": {
      "type": "string",
      "pattern": "^[0-9]+-[0-9]+$",
      "description": "Story ID where agent was implemented"
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Date when agent spec was documented"
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "Date of most recent spec update"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this agent is deprecated"
    },
    "superseded_by": {
      "type": "string",
      "description": "unique_id of replacement agent spec"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version of this specification"
    },
    "replaces": {
      "type": "string",
      "description": "unique_id of previous spec version"
    },
    "breaking_change": {
      "type": "boolean",
      "description": "Does this version break compatibility?"
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Importance level of this agent"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence in spec accuracy"
    },
    "source": {
      "type": "string",
      "enum": [
        "documentation",
        "code_review",
        "implementation",
        "testing"
      ],
      "description": "Source of this specification"
    },
    "common_errors": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Known errors when using this agent",
      "examples": [["calling before classification complete", "missing required field"]]
    },
    "input_schema": {
      "type": "object",
      "description": "JSON schema or description of expected input"
    },
    "output_schema": {
      "type": "object",
      "description": "JSON schema or description of output format"
    },
    "configuration": {
      "type": "object",
      "description": "Required configuration parameters"
    },
    "test_files": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Test file paths",
      "examples": [["tests/unit/agents/test_agent_15.py", "tests/integration/test_agent_15_integration.py"]]
    },
    "implementation_files": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Main implementation file paths"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 3,
      "maxItems": 15,
      "description": "Key terms for search"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Related knowledge entries"
    },
    "search_intent": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Search queries that should find this",
      "examples": [["how to use agent 15", "storage routing integration", "tier assignment"]]
    },
    "performance_characteristics": {
      "type": "object",
      "properties": {
        "average_latency_ms": {
          "type": "number"
        },
        "throughput": {
          "type": "string"
        },
        "resource_usage": {
          "type": "string"
        }
      },
      "description": "Performance metrics and characteristics"
    },
    "error_handling": {
      "type": "string",
      "description": "How this agent handles errors and edge cases"
    },
    "retry_logic": {
      "type": "boolean",
      "description": "Whether agent implements retry on failure"
    }
  },
  "additionalProperties": false
}
