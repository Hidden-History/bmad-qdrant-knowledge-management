{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Story Outcome Metadata Schema",
  "description": "Metadata schema for story outcome knowledge entries",
  "type": "object",
  "required": [
    "unique_id",
    "type",
    "story_id",
    "component",
    "importance",
    "created_at"
  ],
  "properties": {
    "unique_id": {
      "type": "string",
      "pattern": "^story-[0-9]+-[0-9]+-complete$",
      "description": "Format: story-{epic}-{story}-complete",
      "examples": ["story-2-17-complete", "story-1-3-complete"]
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for deduplication"
    },
    "type": {
      "type": "string",
      "const": "story_outcome",
      "description": "Must be 'story_outcome'"
    },
    "story_id": {
      "type": "string",
      "pattern": "^[0-9]+-[0-9]+$",
      "description": "Story identifier (epic-story)",
      "examples": ["2-17", "1-3"]
    },
    "epic_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Epic number",
      "examples": ["1", "2"]
    },
    "component": {
      "type": "string",
      "enum": [
        "qdrant",
        "postgres",
        "neo4j",
        "agents",
        "docker",
        "api",
        "dashboard",
        "infrastructure",
        "testing",
        "documentation"
      ],
      "description": "Primary component affected by this story"
    },
    "sub_component": {
      "type": "string",
      "description": "Specific subcomponent or feature",
      "examples": ["agent_15", "storage_routing", "metadata_extraction"]
    },
    "affects": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of system parts modified by this story"
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Date when story was completed"
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "Date of most recent update to outcome documentation"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this implementation was replaced"
    },
    "superseded_by": {
      "type": "string",
      "description": "Story ID that replaced this functionality"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version of this outcome documentation"
    },
    "replaces": {
      "type": "string",
      "description": "Previous version unique_id"
    },
    "breaking_change": {
      "type": "boolean",
      "description": "Did this story introduce breaking changes?"
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Importance of this story's outcomes"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence in documentation accuracy"
    },
    "source": {
      "type": "string",
      "enum": [
        "implementation_complete",
        "code_review",
        "testing",
        "documentation"
      ],
      "description": "Source of this outcome documentation"
    },
    "completion_date": {
      "type": "string",
      "format": "date",
      "description": "When the story was marked done"
    },
    "story_status": {
      "type": "string",
      "enum": ["done", "partially_complete", "blocked", "deferred"],
      "description": "Final status of the story"
    },
    "implementation_summary": {
      "type": "string",
      "description": "Brief summary of what was built"
    },
    "integration_points": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "How this story integrates with other components"
    },
    "common_errors": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Errors discovered during implementation"
    },
    "testing_notes": {
      "type": "string",
      "description": "How to test this feature"
    },
    "test_files": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Test file paths created or modified"
    },
    "files_modified": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of files changed in this story"
    },
    "files_created": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of new files created"
    },
    "migrations": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Database migrations created",
      "examples": [["migrations/024_database_routing_log.sql"]]
    },
    "configuration_changes": {
      "type": "object",
      "description": "Environment variables or config changes"
    },
    "performance_impact": {
      "type": "string",
      "description": "How this story affected system performance"
    },
    "security_considerations": {
      "type": "string",
      "description": "Security implications of this implementation"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 3,
      "maxItems": 15,
      "description": "Key terms for search"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Related knowledge entries"
    },
    "search_intent": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Search queries that should find this"
    },
    "lessons_learned": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Key learnings from this story"
    },
    "technical_debt": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Known technical debt introduced or remaining"
    },
    "follow_up_stories": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[0-9]+-[0-9]+$"
      },
      "description": "Story IDs of follow-up work"
    }
  },
  "additionalProperties": false
}
