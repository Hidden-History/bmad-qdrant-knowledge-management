{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Error Pattern Metadata Schema",
  "description": "Metadata schema for error pattern knowledge entries",
  "type": "object",
  "required": [
    "unique_id",
    "type",
    "component",
    "severity",
    "importance",
    "created_at"
  ],
  "properties": {
    "unique_id": {
      "type": "string",
      "pattern": "^error-[a-z0-9-]+$",
      "description": "Format: error-{short-description}",
      "examples": ["error-docker-postgres-connection", "error-qdrant-collection-missing"]
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for deduplication"
    },
    "type": {
      "type": "string",
      "const": "error_pattern",
      "description": "Must be 'error_pattern'"
    },
    "component": {
      "type": "string",
      "enum": [
        "qdrant",
        "postgres",
        "neo4j",
        "redis",
        "agents",
        "docker",
        "api",
        "dashboard",
        "networking",
        "storage",
        "authentication"
      ],
      "description": "Component where error occurs"
    },
    "sub_component": {
      "type": "string",
      "description": "Specific subcomponent",
      "examples": ["connection_pool", "migration_script", "agent_15"]
    },
    "severity": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Error severity level"
    },
    "error_category": {
      "type": "string",
      "enum": [
        "connection",
        "configuration",
        "permission",
        "data_validation",
        "resource",
        "timeout",
        "compatibility",
        "security",
        "logic"
      ],
      "description": "Category of error"
    },
    "epic_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Epic where error was discovered"
    },
    "story_id": {
      "type": "string",
      "pattern": "^[0-9]+-[0-9]+$",
      "description": "Story where error was discovered"
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Date when error pattern was documented"
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "Date of most recent update"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this error pattern is no longer relevant"
    },
    "superseded_by": {
      "type": "string",
      "description": "unique_id of updated error pattern"
    },
    "resolved": {
      "type": "boolean",
      "default": false,
      "description": "Whether this error has been permanently fixed"
    },
    "resolution_date": {
      "type": "string",
      "format": "date",
      "description": "When this error was resolved"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version of this documentation"
    },
    "replaces": {
      "type": "string",
      "description": "Previous version unique_id"
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Importance of knowing this error pattern"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence in solution effectiveness"
    },
    "source": {
      "type": "string",
      "enum": [
        "production_incident",
        "testing",
        "development",
        "code_review",
        "monitoring"
      ],
      "description": "Where this error was discovered"
    },
    "error_message": {
      "type": "string",
      "description": "Exact or typical error message text"
    },
    "error_code": {
      "type": "string",
      "description": "Error code if applicable"
    },
    "symptoms": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Observable symptoms of this error",
      "examples": [["connection timeout", "empty response", "500 error"]]
    },
    "root_cause": {
      "type": "string",
      "description": "Detailed explanation of why this error occurs"
    },
    "solution": {
      "type": "string",
      "description": "How to fix this error"
    },
    "workaround": {
      "type": "string",
      "description": "Temporary workaround if full solution not available"
    },
    "prevention": {
      "type": "string",
      "description": "How to prevent this error in future"
    },
    "affected_versions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Software versions where this error occurs"
    },
    "environment": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["development", "testing", "staging", "production", "local", "vps"]
      },
      "description": "Environments where this error occurs"
    },
    "frequency": {
      "type": "string",
      "enum": ["always", "often", "sometimes", "rarely"],
      "description": "How often this error occurs"
    },
    "reproduction_steps": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Steps to reproduce the error"
    },
    "diagnostic_steps": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "How to diagnose this error"
    },
    "logs_to_check": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Which log files to examine",
      "examples": [["docker logs legal-ai-postgres", "/var/log/qdrant/db1.log"]]
    },
    "related_errors": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "unique_ids of related error patterns"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 3,
      "maxItems": 15,
      "description": "Key terms for search"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Related knowledge entries"
    },
    "search_intent": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Search queries that should find this",
      "examples": [["postgres connection refused", "docker database error"]]
    },
    "impact": {
      "type": "string",
      "description": "What breaks when this error occurs"
    },
    "time_to_resolve": {
      "type": "string",
      "description": "Estimated time to fix",
      "examples": ["5 minutes", "1 hour", "requires restart"]
    }
  },
  "additionalProperties": false
}
