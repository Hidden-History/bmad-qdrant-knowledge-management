{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Architecture Decision Metadata Schema",
  "description": "Metadata schema for architecture decision knowledge entries",
  "type": "object",
  "required": [
    "unique_id",
    "type",
    "component",
    "importance",
    "created_at",
    "breaking_change"
  ],
  "properties": {
    "unique_id": {
      "type": "string",
      "pattern": "^arch-decision-[a-z0-9-]+-[0-9]{4}-[0-9]{2}-[0-9]{2}$",
      "description": "Format: arch-decision-{topic}-{YYYY-MM-DD}",
      "examples": ["arch-decision-5tier-qdrant-2024-12-15"]
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for deduplication"
    },
    "type": {
      "type": "string",
      "const": "architecture_decision",
      "description": "Must be 'architecture_decision'"
    },
    "component": {
      "type": "string",
      "enum": [
        "qdrant",
        "postgres",
        "neo4j",
        "agents",
        "docker",
        "api",
        "infrastructure",
        "storage",
        "networking",
        "security",
        "monitoring"
      ],
      "description": "Primary system component affected"
    },
    "sub_component": {
      "type": "string",
      "description": "Specific subcomponent or service",
      "examples": ["agent_15", "chunks_table", "tier_routing"]
    },
    "affects": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "List of system parts impacted by this decision",
      "examples": [["storage", "routing", "retrieval"]]
    },
    "epic_id": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Epic number if applicable",
      "examples": ["1", "2"]
    },
    "story_id": {
      "type": "string",
      "pattern": "^[0-9]+-[0-9]+$",
      "description": "Story ID if decision made during story",
      "examples": ["1-3", "2-17"]
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Date when decision was made (YYYY-MM-DD)"
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "Date of most recent update"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this decision has been superseded"
    },
    "superseded_by": {
      "type": "string",
      "description": "unique_id of newer decision that replaces this"
    },
    "deprecated_at": {
      "type": "string",
      "format": "date",
      "description": "Date when deprecated"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version number of this decision"
    },
    "replaces": {
      "type": "string",
      "description": "unique_id of previous version"
    },
    "breaking_change": {
      "type": "boolean",
      "description": "Does this decision break existing patterns or require migration?"
    },
    "importance": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Impact level of this decision"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence in this decision (0.0-1.0)"
    },
    "source": {
      "type": "string",
      "enum": [
        "documentation",
        "code_review",
        "testing",
        "research",
        "incident_analysis",
        "performance_analysis",
        "team_decision"
      ],
      "description": "Source of this decision"
    },
    "decision_date": {
      "type": "string",
      "format": "date",
      "description": "When the decision was formally made"
    },
    "alternatives_considered": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Other options that were evaluated"
    },
    "trade_offs": {
      "type": "object",
      "properties": {
        "pros": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "cons": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "description": "Advantages and disadvantages of this decision"
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 3,
      "maxItems": 15,
      "description": "Key terms for search optimization"
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Related knowledge entry IDs"
    },
    "search_intent": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "How users might search for this",
      "examples": [["how to configure tiers", "storage architecture", "qdrant setup"]]
    },
    "migration_required": {
      "type": "boolean",
      "description": "Does implementing this require data migration?"
    },
    "migration_guide": {
      "type": "string",
      "description": "Link to migration documentation or steps"
    }
  },
  "additionalProperties": false
}
